# C/C++中.h文件的作用

在c/c++中头文件是一个很重要的部分。由于项目的规模问题，一般会将不同功能的模块通过不同的文件组织起来，尤其是在C中。在开发的时候一般会将函数或变量的申明定义放在.h文件中，将实现放在.c文件中。对于常用到包含下层接口函数的.h文件还会被多个.c文件引用。但是这样写有什么作用?，为什么不包含对应的头文件有时候就会出现错误呢？这篇文章将从以下几个方面讲解：

## 预处理

在平时开发的时候，只需要点一下run按钮我们就能把对应的代码跑起来，但是其实中间的步骤是集成开发环境帮我们做了，一般将我们写的代码转化成可执行文件要经历以下步骤：

1. 预处理
2. 编译
3. 汇编
4. 链接

其中和头文件有关的处理就在第一个步骤：预处理。预处理会将项目中的宏定义展开(替换)、#ifndef 和#ifdef的部分展开以及处理.c文件中包含的头文件。如果 检测到.c文件中有头文件包含，会将.h文件中的内容插入到预编译指令的位置，这个过程是递归进行的，也就是说包含的.h文件中还可能包含其他的.h文件。

例如，如果a.c文件中包含了a.h文件，而a.h文件中有这样一段代码:

```c++
void fun(int x)
```



那这段代码就会在预处理的时候被插入到a.c文件中去。一般来说,这个函数的实现会放在a.c文件中。

## 作用域

要说清楚.h文件的作用和原理就必须要了解函数/变量作用域。这里只提一下全局函数/变量(以下统称符号)的作用域，全局符号是定义在函数外面的符号。它的作用域是从定义开始到该文件的结束。 例如a.c a.h main.c在一个项目中，我在main.c中想调用在a.h中定义的 fun()函数

```c++
int main(void)
{
  fun(0);
}
```

这样调用肯定是不行的,因为在main.c中并未对fun进行声明和调用，fun函数的作用域仅存在于a.c中。

这里就需要使用一个关键字**extern** 。**extern** 可以将作用域扩展。**如果想使用一个符号，而这个符号又是在其他文件中定义的** ，就可以使用**extern** 关键字。例如上面的例子这样修改:

```c++
extern void fun(int x);
int main(void)
{
  fun(0);
}
```

就可以成功的调用fun函数了。到这里会有很多人有疑问，平时没有**extern** 关键字，像下面这样:

```c++
void fun(int x);
int main(void)
{
  fun(0);
}
```

也是可以成功调用的啊？那是因为在C99标准之后默认的外部变量/函数都默认被加上了**extern** 关键字，所以不加也是可以的。但是建议在开发中这种全局变量最好加上**extern**关键字便于代码维护和阅读。

到这里.h文件的作用就一目了然了。假如**目标文件** 想引用**被引用文件** 中的一个符号时，只需要包含声明该符号的头文件即可。因为头文件中的内容会复制到目标文件中， 相当在文件头添加了一个对该符号的**extern** 声明，说明了该符号是在其他文件中定义的。例如上例中的代码这样修改:

```c++
#include"a.h"//这句话会在预处理的时候处理为void fun(int x)
int main(void)
{
  fun(0);
}
```

也是可以成功运行的。同时，如果不加头文件也不加上**extern** 关键字的使用，就会报出找不到fun这个符号的错误。

## 使用.h的优点

在上面提到过，包含一个.h文件和添加声明效果其实是一样的。那使用头文件有什么好处呢?最直观的好处就是便于维护。例如在base.h中有一个函数是这样声明的:

```c++
void base(int x);
```

这个函数被100个.c文件调用。如果使用声明的方法，就需要在这100个c文件中都声明一次。如果某一天这个函数需要修改，那这100个.c文件的声明都需要修改。而使用包含头文件的方法就只需要在base.h中修改一次即可。

此外，

## 是否必须使用.h文件？

从上面可以看出明显是不需要的，只需要在适当的位置写好符号的声明即可。**在一个项目中只写.c文件，不写.h文件是完全可以的，.h文件不是语法要求** 但是使用头文件的方式可以更好的组织项目文件，减少重复代码，更利于代码的维护和阅读。



